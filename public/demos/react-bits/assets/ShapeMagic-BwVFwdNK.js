import{c as rt,r as b,j as e,B as tt,F as D,I as nt,E as Wt,a as I,l as It,d as Ft,K as Pt}from"./index-CKqfvLoB.js";import{E as At,T as Nt,C as Ut}from"./trash-2-DfKQZgOT.js";import{P as Vt}from"./plus-Dxz4vEQb.js";import{C as Lt,D as Kt,u as Gt,S as qt}from"./settings-Begyc4AN.js";import{C as Dt}from"./code-xml-Cy_tLMfM.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ot=[["rect",{width:"6",height:"14",x:"2",y:"5",rx:"2",key:"dy24zr"}],["rect",{width:"6",height:"10",x:"16",y:"7",rx:"2",key:"13zkjt"}],["path",{d:"M12 2v20",key:"t6zp3m"}]],Zt=rt("align-horizontal-justify-center",Ot);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=[["rect",{width:"6",height:"14",x:"2",y:"5",rx:"2",key:"dy24zr"}],["rect",{width:"6",height:"10",x:"12",y:"7",rx:"2",key:"1ht384"}],["path",{d:"M22 2v20",key:"40qfg1"}]],Qt=rt("align-horizontal-justify-end",Jt);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"6",height:"14",x:"6",y:"5",rx:"2",key:"hsirpf"}],["rect",{width:"6",height:"10",x:"16",y:"7",rx:"2",key:"13zkjt"}],["path",{d:"M2 2v20",key:"1ivd8o"}]],ee=rt("align-horizontal-justify-start",te);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["rect",{width:"6",height:"10",x:"9",y:"7",rx:"2",key:"yn7j0q"}],["path",{d:"M4 22V2",key:"tsjzd3"}],["path",{d:"M20 22V2",key:"1bnhr8"}]],oe=rt("align-horizontal-space-around",ne);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["rect",{width:"14",height:"6",x:"5",y:"16",rx:"2",key:"1i8z2d"}],["rect",{width:"10",height:"6",x:"7",y:"2",rx:"2",key:"ypihtt"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],re=rt("align-vertical-justify-center",ie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=[["rect",{width:"14",height:"6",x:"5",y:"12",rx:"2",key:"4l4tp2"}],["rect",{width:"10",height:"6",x:"7",y:"2",rx:"2",key:"ypihtt"}],["path",{d:"M2 22h20",key:"272qi7"}]],ae=rt("align-vertical-justify-end",se);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["rect",{width:"14",height:"6",x:"5",y:"16",rx:"2",key:"1i8z2d"}],["rect",{width:"10",height:"6",x:"7",y:"6",rx:"2",key:"13squh"}],["path",{d:"M2 2h20",key:"1ennik"}]],le=rt("align-vertical-justify-start",ce);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["rect",{width:"10",height:"6",x:"7",y:"9",rx:"2",key:"b1zbii"}],["path",{d:"M22 20H2",key:"1p1f7z"}],["path",{d:"M22 4H2",key:"1b7qnq"}]],he=rt("align-vertical-space-around",de);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"m5 12-3 3 3 3",key:"oke12k"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]],fe=rt("file-code-2",xe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M10 8h.01",key:"1r9ogq"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M14 8h.01",key:"1primd"}],["path",{d:"M16 12h.01",key:"1l6xoz"}],["path",{d:"M18 8h.01",key:"emo2bl"}],["path",{d:"M6 8h.01",key:"x9i8wu"}],["path",{d:"M7 16h10",key:"wp8him"}],["path",{d:"M8 12h.01",key:"czm47f"}],["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}]],ue=rt("keyboard",pe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"m21 3-7 7",key:"1l2asr"}],["path",{d:"m3 21 7-7",key:"tjx5ai"}],["path",{d:"M9 21H3v-6",key:"wtvkvv"}]],ye=rt("maximize-2",ge);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m8 6 4-4 4 4",key:"ybng9g"}],["path",{d:"M12 2v10.3a4 4 0 0 1-1.172 2.872L4 22",key:"1hyw0i"}],["path",{d:"m20 22-5-5",key:"1m27yz"}]],be=rt("merge",me),Ct=(n,x=0)=>{switch(x){case 0:return`M 0 0 C 0 ${n*.746} ${n*.18} ${n} ${n} ${n} H 0 Z`;case 90:return`M 0 0 C 0 ${n*.746} ${-n*.18} ${n} ${-n} ${n} H 0 Z`;case 180:return`M 0 0 C 0 ${-n*.746} ${-n*.18} ${-n} ${-n} ${-n} H 0 Z`;case 270:return`M 0 0 C 0 ${-n*.746} ${n*.18} ${-n} ${n} ${-n} H 0 Z`;default:return`M 0 0 C 0 ${n*.746} ${n*.18} ${n} ${n} ${n} H 0 Z`}},Et=(n,x,i,l,g)=>{const{tl:f,tr:p,br:h,bl:w}=g,u=Math.min(i/2,l/2),s=Math.min(f,u),c=Math.min(p,u),a=Math.min(h,u),y=Math.min(w,u);return`
    M ${n+s} ${x}
    L ${n+i-c} ${x}
    ${c>0?`A ${c} ${c} 0 0 1 ${n+i} ${x+c}`:`L ${n+i} ${x}`}
    L ${n+i} ${x+l-a}
    ${a>0?`A ${a} ${a} 0 0 1 ${n+i-a} ${x+l}`:`L ${n+i} ${x+l}`}
    L ${n+w} ${x+l}
    ${y>0?`A ${y} ${y} 0 0 1 ${n} ${x+l-y}`:`L ${n} ${x+l}`}
    L ${n} ${x+s}
    ${s>0?`A ${s} ${s} 0 0 1 ${n+s} ${x}`:`L ${n} ${x}`}
    Z
  `.trim().replace(/\s+/g," ")},zt=(n,x,i,l,g)=>{let p=1/0,h=1/0,w=-1/0,u=-1/0;n.forEach(o=>{p=Math.min(p,o.x),h=Math.min(h,o.y),w=Math.max(w,o.x+o.w),u=Math.max(u,o.y+o.h)});const s=w-p+10*2,c=u-h+10*2,a=-p+10,y=-h+10,E=n.map(o=>{const t=i[o.id]||{tl:g,tr:g,br:g,bl:g};return`<path d="${Et(o.x+a,o.y+y,o.w,o.h,t)}" />`}).join(`
    `),j=x.map(o=>{const t=`translate(${o.x+a}, ${o.y+y})`;return`<path d="${Ct(o.r,o.rotation)}" transform="${t}" />`}).join(`
    `);return`<svg width="${s}" height="${c}" viewBox="0 0 ${s} ${c}" xmlns="http://www.w3.org/2000/svg">
  <g fill="${l.fill}" stroke="${l.stroke}" stroke-width="${l.strokeWidth}">
    ${E}
    ${j}
  </g>
</svg>`},we=(n,x,i,l,g)=>{let p=1/0,h=1/0,w=-1/0,u=-1/0;n.forEach(o=>{p=Math.min(p,o.x),h=Math.min(h,o.y),w=Math.max(w,o.x+o.w),u=Math.max(u,o.y+o.h)});const s=w-p+10*2,c=u-h+10*2,a=-p+10,y=-h+10,E=[];n.forEach(o=>{const t=i[o.id]||{tl:g,tr:g,br:g,bl:g};E.push(Et(o.x+a,o.y+y,o.w,o.h,t))}),x.forEach(o=>{const t=Ct(o.r,o.rotation),L=Xt(t,o.x+a,o.y+y);E.push(L)});const j=E.join(" ");return`<svg width="${s}" height="${c}" viewBox="0 0 ${s} ${c}" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <clipPath id="merged-shape-clip">
      <path d="${j}" fill-rule="nonzero" />
    </clipPath>
  </defs>
  
  <!-- The merged shape - use as mask for images/videos -->
  <path d="${j}" fill="${l.fill}" fill-rule="nonzero" />
  
  <!-- Example: Clipped content container -->
  <!-- <g clip-path="url(#merged-shape-clip)">
    <image href="your-image.jpg" x="0" y="0" width="${s}" height="${c}" preserveAspectRatio="xMidYMid slice" />
  </g> -->
</svg>`},je=(n,x,i,l)=>{let f=1/0,p=1/0,h=-1/0,w=-1/0;n.forEach(j=>{f=Math.min(f,j.x),p=Math.min(p,j.y),h=Math.max(h,j.x+j.w),w=Math.max(w,j.y+j.h)});const u=h-f+10*2,s=w-p+10*2,c=-f+10,a=-p+10,y=[];n.forEach(j=>{const o=i[j.id]||{tl:l,tr:l,br:l,bl:l};y.push(Et(j.x+c,j.y+a,j.w,j.h,o))}),x.forEach(j=>{const o=Ct(j.r,j.rotation),t=Xt(o,j.x+c,j.y+a);y.push(t)});const E=y.join(" ").replace(/\s+/g," ").trim();return`/* Container dimensions: ${Math.round(u)}px × ${Math.round(s)}px */
.clipped-element {
  clip-path: path('${E}');
  width: ${Math.round(u)}px;
  height: ${Math.round(s)}px;
}`},Xt=(n,x,i)=>n.replace(/(-?\d+\.?\d*)/g,(l,g,f,p)=>{const h=p.slice(0,f),w=h.match(/[MLHVCSQTAZ]/gi);if(!w)return l;const u=w[w.length-1].toUpperCase(),s=parseFloat(g),y=(h.slice(h.lastIndexOf(u)+1).match(/-?\d+\.?\d*/g)||[]).length%2===0;return u==="H"?String(s+x):u==="V"?String(s+i):u==="Z"||u==="A"?l:String(y?s+x:s+i)}),ke=(n,x,i,l,g,f,p)=>{const h=[];for(const w of x){let u=w.x,s;w.rotation===0||w.rotation===90?s=w.y+w.r:s=w.y-w.r;let c,a,y,E;switch(w.rotation){case 0:c=u,E=s,a=g,y=f;for(const t of n)t.x<y&&t.x+t.w>c&&t.y+t.h<=s&&t.y+t.h>a&&(a=t.y+t.h),t.y<s&&t.x>=u&&t.x<y&&(y=t.x);break;case 90:y=u,E=s,a=g,c=l;for(const t of n)t.x<y&&t.x+t.w>c&&t.y+t.h<=s&&t.y+t.h>a&&(a=t.y+t.h),t.y<s&&t.x+t.w<=u&&t.x+t.w>c&&(c=t.x+t.w);break;case 180:y=u,a=s,E=p,c=l;for(const t of n)t.x<y&&t.x+t.w>c&&t.y>=s&&t.y<E&&(E=t.y),t.y+t.h>s&&t.x+t.w<=u&&t.x+t.w>c&&(c=t.x+t.w);break;case 270:c=u,a=s,E=p,y=f;for(const t of n)t.x<y&&t.x+t.w>c&&t.y>=s&&t.y<E&&(E=t.y),t.y+t.h>s&&t.x>=u&&t.x<y&&(y=t.x);break;default:continue}const j=y-c,o=E-a;if(j>0&&o>0){const t={id:`negative-${h.length}`,x:c,y:a,w:j,h:o,rotation:w.rotation};let L=!0;for(const m of h){const F=Math.max(t.x,m.x),P=Math.max(t.y,m.y),q=Math.min(t.x+t.w,m.x+m.w),V=Math.min(t.y+t.h,m.y+m.h);if(F<q&&P<V){if(t.x===m.x&&t.y===m.y)if(t.w>m.w){const ot=m.y+m.h;m.y=t.y+t.h,m.h=ot-m.y}else t.y=m.y+m.h,t.h=E-t.y;else t.y<m.y?t.h=m.y-t.y:t.x<m.x?t.w=m.x-t.x:L=!1;(t.w<=0||t.h<=0)&&(L=!1)}}for(let m=h.length-1;m>=0;m--)(h[m].w<=0||h[m].h<=0)&&h.splice(m,1);L&&t.w>0&&t.h>0&&h.push(t)}}return h},$e=(n,x,i,l,g,f="MergedShape")=>{let p=1/0,h=1/0,w=-1/0,u=-1/0;n.forEach(o=>{p=Math.min(p,o.x),h=Math.min(h,o.y),w=Math.max(w,o.x+o.w),u=Math.max(u,o.y+o.h)});const s=w-p,c=u-h,a=ke(n,x,g,p,h,w,u),y=n.map((o,t)=>{const L=i[o.id]||{tl:g,tr:g,br:g,bl:g},m=o.x-p,F=o.y-h;return`      {/* Shape ${t+1} */}
      <div
        style={{
          position: 'absolute',
          left: ${m},
          top: ${F},
          width: ${o.w},
          height: ${o.h},
          backgroundColor: fill,
          borderRadius: '${L.tl}px ${L.tr}px ${L.br}px ${L.bl}px',
        }}
      >
        {/* Add content here */}
      </div>`}).join(`
`),E=a.map((o,t)=>{const L=o.x-p,m=o.y-h;return`      {/* Negative Space ${t+1} - Content container for empty region */}
      <div
        style={{
          position: 'absolute',
          left: ${L},
          top: ${m},
          width: ${o.w},
          height: ${o.h},
          // Transparent container for content in negative space
        }}
      >
        {/* Add content here */}
      </div>`}).join(`
`),j=x.map((o,t)=>{const L=o.x-p,m=o.y-h,F=o.r;let P,q=0,V=0;switch(o.rotation){case 0:P=`0 0 ${F} ${F}`;break;case 90:P=`${-F} 0 ${F} ${F}`,q=-F;break;case 180:P=`${-F} ${-F} ${F} ${F}`,q=-F,V=-F;break;case 270:P=`0 ${-F} ${F} ${F}`,V=-F;break;default:P=`0 0 ${F} ${F}`}return`      {/* Bridge ${t+1} */}
      <svg
        style={{
          position: 'absolute',
          left: ${L+q},
          top: ${m+V},
          width: ${F},
          height: ${F},
          pointerEvents: 'none',
        }}
        viewBox="${P}"
      >
        <path d="${Ct(o.r,o.rotation)}" fill={fill} />
      </svg>`}).join(`
`);return`const ${f} = ({ fill = "${l.fill}", children, style: containerStyle, ...props }) => (
  <div
    style={{
      position: 'relative',
      width: ${s},
      height: ${c},
      ...containerStyle,
    }}
    {...props}
  >
${y}
${E}
${j}
    {children}
  </div>
);

export default ${f};`},Tt=b.forwardRef(({shapes:n,bridges:x,cornerRadii:i,globalRadius:l,style:g,selectedIds:f,onShapeUpdate:p,onSelectionChange:h,onDragEnd:w,onAltDragDuplicate:u,snapToGrid:s,gridSize:c,showBridgeDebug:a=!1,onShowBridgeDebugChange:y},E)=>{const j=b.useRef(null),o=b.useRef(!1),[t,L]=b.useState({x:0,y:0}),[m,F]=b.useState(1),[P,q]=b.useState(!1),[V,ot]=b.useState(!1),[ct,W]=b.useState(!1),[it,O]=b.useState(null),[X,et]=b.useState(null),[A,G]=b.useState(null),[N,K]=b.useState(null),[ft,gt]=b.useState(!1),lt=b.useRef(!1),[S,d]=b.useState(null),[$,T]=b.useState(null),Y=b.useCallback(()=>{if(n.length===0)return;const r=j.current;if(!r)return;const k=r.getBoundingClientRect();if(k.width===0||k.height===0)return;const M=Math.min(...n.map(st=>st.x)),v=Math.min(...n.map(st=>st.y)),B=Math.max(...n.map(st=>st.x+st.w)),C=Math.max(...n.map(st=>st.y+st.h)),z=B-M,_=C-v,U=M+z/2,Z=v+_/2,pt=60,mt=k.width-pt*2,J=k.height-pt*2,St=mt/z,Mt=J/_,jt=Math.min(St,Mt,2),Q=k.width/2,kt=k.height/2;F(jt),L({x:Q-U*jt,y:kt-Z*jt})},[n]);b.useImperativeHandle(E,()=>({fitToView:Y}),[Y]),b.useEffect(()=>{if(o.current||n.length===0)return;const r=j.current;r&&requestAnimationFrame(()=>{const k=r.getBoundingClientRect();if(k.width===0||k.height===0)return;const M=Math.min(...n.map(J=>J.x)),v=Math.min(...n.map(J=>J.y)),B=Math.max(...n.map(J=>J.x+J.w)),C=Math.max(...n.map(J=>J.y+J.h)),z=B-M,_=C-v,U=M+z/2,Z=v+_/2,pt=k.width/2,mt=k.height/2;L({x:pt-U,y:mt-Z}),o.current=!0})},[n]);const wt=b.useCallback((r,k)=>{var v;const M=(v=j.current)==null?void 0:v.getBoundingClientRect();return M?{x:(r-M.left-t.x)/m,y:(k-M.top-t.y)/m}:{x:0,y:0}},[t,m]),R=b.useCallback(r=>s?Math.round(r/c)*c:r,[s,c]);b.useEffect(()=>{const r=M=>{var v;M.code==="Space"&&!M.repeat&&((v=document.activeElement)==null?void 0:v.tagName)!=="INPUT"&&(M.preventDefault(),W(!0))},k=M=>{M.code==="Space"&&(W(!1),ot(!1))};return window.addEventListener("keydown",r),window.addEventListener("keyup",k),()=>{window.removeEventListener("keydown",r),window.removeEventListener("keyup",k)}},[]);const dt=b.useCallback(r=>{var B;r.preventDefault();const k=r.deltaY>0?.9:1.1,M=Math.min(Math.max(m*k,.25),4),v=(B=j.current)==null?void 0:B.getBoundingClientRect();if(v){const C=r.clientX-v.left,z=r.clientY-v.top,_=C-(C-t.x)*(M/m),U=z-(z-t.y)*(M/m);L({x:_,y:U})}F(M)},[m,t]),ht=b.useCallback(r=>{const k=wt(r.clientX,r.clientY);if(ct){ot(!0),O({x:r.clientX,y:r.clientY});return}if(r.target.dataset.handle){const v=r.target.dataset.shapeId,B=n.find(C=>C.id===v);if(B){const C={};(f.includes(v)?f:[v]).forEach(_=>{const U=n.find(Z=>Z.id===_);U&&(C[_]={...U})}),G(r.target.dataset.handle),et(B),O({x:r.clientX,y:r.clientY}),K(C),q(!0);return}}const M=[...n].reverse().find(v=>k.x>=v.x&&k.x<=v.x+v.w&&k.y>=v.y&&k.y<=v.y+v.h);if(M){if(r.altKey&&u){const C=f.includes(M.id)?f:[M.id];lt.current=!1,gt(!0);const z={};C.forEach(_=>{const U=n.find(Z=>Z.id===_);U&&(z[_]={...U})}),et(M),O({x:r.clientX,y:r.clientY}),K(z),q(!0);return}r.shiftKey?f.includes(M.id)?h(f.filter(C=>C!==M.id)):h([...f,M.id]):f.includes(M.id)||h([M.id]);const v=f.includes(M.id)?f:[M.id],B={};v.forEach(C=>{const z=n.find(_=>_.id===C);z&&(B[C]={...z})}),et(M),O({x:r.clientX,y:r.clientY}),K(B),q(!0)}else r.button===1?(ot(!0),O({x:r.clientX,y:r.clientY})):(r.shiftKey||h([]),T(k),d({x:k.x,y:k.y,w:0,h:0}))},[n,f,wt,h,ct,u]),yt=b.useCallback(r=>{if(V&&it){const k=r.clientX-it.x,M=r.clientY-it.y;L(v=>({x:v.x+k,y:v.y+M})),O({x:r.clientX,y:r.clientY});return}if($&&S){const k=wt(r.clientX,r.clientY),M=Math.min($.x,k.x),v=Math.min($.y,k.y),B=Math.abs(k.x-$.x),C=Math.abs(k.y-$.y);d({x:M,y:v,w:B,h:C});return}if(P&&X&&it&&N){const k=(r.clientX-it.x)/m,M=(r.clientY-it.y)/m;if(ft&&!lt.current&&u){if(Math.abs(k)>2||Math.abs(M)>2){const v=Object.keys(N),B=u(v);if(B&&B.length>0){const C={};B.forEach(z=>{C[z.id]={...z}}),K(C),et(B[0]),lt.current=!0,B.forEach(z=>{p(z.id,{x:R(z.x+k),y:R(z.y+M)})})}}return}if(A){const v=Object.keys(N);if(v.length===1){const B=v[0],C=N[B];let z=C.x,_=C.y,U=C.w,Z=C.h;A.includes("w")&&(z=R(C.x+k),U=C.w-(z-C.x)),A.includes("e")&&(U=R(C.w+k)),A.includes("n")&&(_=R(C.y+M),Z=C.h-(_-C.y)),A.includes("s")&&(Z=R(C.h+M)),p(B,{x:R(z),y:R(_),w:R(Math.max(20,U)),h:R(Math.max(20,Z))})}else{const B=Math.min(...v.map(Q=>N[Q].x)),C=Math.min(...v.map(Q=>N[Q].y)),z=Math.max(...v.map(Q=>N[Q].x+N[Q].w)),_=Math.max(...v.map(Q=>N[Q].y+N[Q].h)),U=z-B,Z=_-C;let pt=B,mt=C,J=z,St=_;A.includes("w")&&(pt=R(B+k)),A.includes("e")&&(J=R(z+k)),A.includes("n")&&(mt=R(C+M)),A.includes("s")&&(St=R(_+M));const Mt=Math.max(c*2,J-pt),jt=Math.max(c*2,St-mt);v.forEach(Q=>{const kt=N[Q],st=(kt.x-B)/(U||1),Rt=(kt.y-C)/(Z||1),Ht=kt.w/(U||1),_t=kt.h/(Z||1);p(Q,{x:R(pt+st*Mt),y:R(mt+Rt*jt),w:R(Math.max(c*2,Ht*Mt)),h:R(Math.max(c*2,_t*jt))})})}}else Object.keys(N).forEach(v=>{const B=N[v];p(v,{x:R(B.x+k),y:R(B.y+M)})})}},[V,P,it,X,N,m,A,R,p,$,S,wt,c,ft,u]),H=b.useCallback(()=>{if(S&&$){const r=n.filter(k=>{const M=k.x+k.w,v=k.y+k.h,B=S.x+S.w,C=S.y+S.h;return!(k.x>B||M<S.x||k.y>C||v<S.y)});r.length>0&&h(r.map(k=>k.id))}P&&w&&w(),q(!1),ot(!1),O(null),et(null),G(null),K(null),d(null),T(null),gt(!1),lt.current=!1},[S,$,n,h,P,w]);b.useEffect(()=>{const r=j.current;if(r)return r.addEventListener("wheel",dt,{passive:!1}),()=>r.removeEventListener("wheel",dt)},[dt]);const vt=r=>{if(!f.includes(r.id))return null;const k=8/m;return["nw","n","ne","e","se","s","sw","w"].map(v=>{let B,C;const z=k/2;switch(v){case"nw":B=r.x-z,C=r.y-z;break;case"n":B=r.x+r.w/2-z,C=r.y-z;break;case"ne":B=r.x+r.w-z,C=r.y-z;break;case"e":B=r.x+r.w-z,C=r.y+r.h/2-z;break;case"se":B=r.x+r.w-z,C=r.y+r.h-z;break;case"s":B=r.x+r.w/2-z,C=r.y+r.h-z;break;case"sw":B=r.x-z,C=r.y+r.h-z;break;case"w":B=r.x-z,C=r.y+r.h/2-z;break}return e.jsx("rect",{"data-handle":v,"data-shape-id":r.id,x:B,y:C,width:k,height:k,fill:"#5227FF",stroke:"#fff",strokeWidth:1/m,style:{cursor:`${v}-resize`}},`${r.id}-${v}`)})};return e.jsxs(tt,{ref:j,position:"relative",w:"100%",h:"100%",bg:"#060010",overflow:"hidden",cursor:V||ct?"grab":"default",onMouseDown:ht,onMouseMove:yt,onMouseUp:H,onMouseLeave:H,userSelect:"none",children:[e.jsx(tt,{position:"absolute",left:0,top:0,right:0,bottom:0,opacity:.5,style:{backgroundImage:`
            linear-gradient(#271E37 1px, transparent 1px),
            linear-gradient(90deg, #271E37 1px, transparent 1px)
          `,backgroundSize:`${c*m}px ${c*m}px`,backgroundPosition:`${t.x}px ${t.y}px`}}),e.jsx("svg",{width:"100%",height:"100%",style:{position:"absolute",left:0,top:0},children:e.jsxs("g",{transform:`translate(${t.x}, ${t.y}) scale(${m})`,children:[n.map(r=>{const k=f.includes(r.id),M=i[r.id]||{tl:l,tr:l,br:l,bl:l};return e.jsxs("g",{children:[e.jsx("path",{d:Et(r.x,r.y,r.w,r.h,M),fill:g.fill,stroke:g.stroke,strokeWidth:g.strokeWidth}),k&&e.jsx("rect",{x:r.x-2/m,y:r.y-2/m,width:r.w+4/m,height:r.h+4/m,fill:"none",stroke:"#5227FF",strokeWidth:2/m,strokeDasharray:`${4/m} ${2/m}`})]},r.id)}),x.map(r=>e.jsxs("g",{transform:`translate(${r.x}, ${r.y})`,children:[e.jsx("path",{d:Ct(r.r,r.rotation),fill:g.fill}),a&&e.jsx("circle",{cx:0,cy:0,r:3/m,fill:"#ff0"})]},r.id)),n.map(r=>vt(r)),S&&S.w>0&&S.h>0&&e.jsx("rect",{x:S.x,y:S.y,width:S.w,height:S.h,fill:"rgba(82, 39, 255, 0.1)",stroke:"#5227FF",strokeWidth:1/m,strokeDasharray:`${4/m} ${2/m}`})]})}),e.jsxs(D,{position:"absolute",bottom:4,left:4,gap:2,children:[e.jsxs(D,{as:"button",align:"center",gap:1.5,bg:a?"rgba(82, 39, 255, 0.2)":"rgba(13, 7, 22, 0.9)",border:a?"1px solid #5227FF":"1px solid #271E37",borderRadius:"6px",px:2.5,py:1.5,cursor:"pointer",onClick:()=>y==null?void 0:y(!a),transition:"all 0.15s",_hover:{borderColor:"#5227FF"},children:[e.jsx(nt,{as:a?Wt:At,boxSize:3.5,color:"#988BC7"}),e.jsx(I,{fontSize:"11px",color:"#988BC7",fontWeight:500,children:"Bridges"})]}),e.jsxs(D,{as:"button",align:"center",gap:1.5,bg:"rgba(13, 7, 22, 0.9)",border:"1px solid #271E37",borderRadius:"6px",px:2.5,py:1.5,cursor:"pointer",onClick:Y,transition:"all 0.15s",_hover:{borderColor:"#5227FF"},children:[e.jsx(nt,{as:ye,boxSize:3.5,color:"#988BC7"}),e.jsx(I,{fontSize:"11px",color:"#988BC7",fontWeight:500,children:"Fit"})]})]}),e.jsxs(tt,{position:"absolute",bottom:4,right:4,bg:"rgba(13, 7, 22, 0.9)",border:"1px solid #271E37",borderRadius:"6px",px:3,py:1,fontSize:"12px",color:"#988BC7",fontWeight:500,children:[Math.round(m*100),"%"]})]})});Tt.displayName="Canvas";const ve=({label:n,value:x,onChange:i})=>e.jsxs(D,{align:"center",gap:2,children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",minW:"60px",children:n}),e.jsx(D,{position:"relative",w:"32px",h:"32px",borderRadius:"6px",border:"1px solid #271E37",overflow:"hidden",bg:x,flexShrink:0,children:e.jsx(Ft,{type:"color",value:x,onChange:l=>i(l.target.value),position:"absolute",top:0,left:0,w:"100%",h:"100%",opacity:0,cursor:"pointer"})}),e.jsx(Ft,{value:x,onChange:l=>i(l.target.value),size:"sm",bg:"#170D27",border:"1px solid #271E37",borderRadius:"6px",color:"#fff",fontSize:"12px",px:2,h:"32px",fontFamily:"mono",_focus:{borderColor:"#5227FF",boxShadow:"none"}})]}),$t=({label:n,value:x,onChange:i,min:l,max:g,step:f=1})=>e.jsxs(D,{align:"center",gap:2,flex:1,minW:0,children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",minW:"24px",flexShrink:0,children:n}),e.jsx(Ft,{type:"number",value:Math.round(x),onChange:p=>i(parseFloat(p.target.value)||0),min:l,max:g,step:f,size:"sm",bg:"#170D27",border:"1px solid #271E37",borderRadius:"6px",color:"#fff",fontSize:"12px",px:2,h:"32px",flex:1,minW:0,_focus:{borderColor:"#5227FF",boxShadow:"none"}})]}),at=({icon:n,label:x,isActive:i,onClick:l,disabled:g,flex:f})=>e.jsxs(D,{as:"button",type:"button",align:"center",justify:"center",gap:1.5,px:2.5,py:1.5,flex:f,bg:i?"rgba(82, 39, 255, 0.2)":"#170D27",border:i?"1px solid #5227FF":"1px solid #271E37",borderRadius:"6px",cursor:g?"not-allowed":"pointer",opacity:g?.5:1,onClick:g?void 0:l,transition:"all 0.15s",_hover:{borderColor:g?"#271E37":"#5227FF"},children:[e.jsx(nt,{as:n,boxSize:3.5,color:i?"#5227FF":"#988BC7"}),x&&e.jsx(I,{fontSize:"11px",color:i?"#5227FF":"#988BC7",children:x})]}),bt=({children:n})=>e.jsx(I,{fontSize:"11px",color:"#988BC7",fontWeight:600,mb:3,textTransform:"uppercase",letterSpacing:"0.5px",children:n}),xt=({children:n})=>e.jsx(Pt,{bg:"#0D0716",borderColor:"#392e4e",color:"#B19EEF",fontSize:"11px",fontWeight:500,px:1.5,py:.5,borderRadius:"4px",children:n});function Yt({shapes:n,bridges:x,cornerRadii:i,selectedIds:l,style:g,globalRadius:f,onAddShape:p,onDeleteShapes:h,onDuplicateShapes:w,onStyleChange:u,onGlobalRadiusChange:s,onShapeUpdate:c,onAlignShapes:a,onDistributeShapes:y,toolSelector:E,disabled:j=!1}){const[o,t]=b.useState(null),[L,m]=b.useState(!1),F=n.find(X=>X.id===l[0]),P=l.length>1,q=b.useCallback(()=>{const X=zt(n,x,i||{},g,f);navigator.clipboard.writeText(X),t("svg"),setTimeout(()=>t(null),2e3)},[n,x,i,f,g]),V=b.useCallback(()=>{const X=$e(n,x,i||{},g,f);navigator.clipboard.writeText(X),t("react"),setTimeout(()=>t(null),2e3)},[n,x,i,f,g]),ot=b.useCallback(()=>{const X=we(n,x,i||{},g,f);navigator.clipboard.writeText(X),t("merged"),setTimeout(()=>t(null),2e3)},[n,x,i,f,g]),ct=b.useCallback(()=>{const X=zt(n,x,i||{},g,f),et=new Blob([X],{type:"image/svg+xml"}),A=URL.createObjectURL(et),G=document.createElement("a");G.download="merged-shape.svg",G.href=A,G.click(),URL.revokeObjectURL(A)},[n,x,i,f,g]),W=b.useCallback(()=>{const X=je(n,x,i||{},f);navigator.clipboard.writeText(X),t("css"),setTimeout(()=>t(null),2e3)},[n,x,i,f]),it=b.useCallback(()=>{const X=zt(n,x,i||{},g,f),et=new Blob([X],{type:"image/svg+xml"}),A=URL.createObjectURL(et),G=new window.Image;G.onload=()=>{const K=document.createElement("canvas");K.width=G.width*2,K.height=G.height*2;const ft=K.getContext("2d");ft.scale(2,2),ft.drawImage(G,0,0),URL.revokeObjectURL(A),K.toBlob(gt=>{const lt=URL.createObjectURL(gt),S=document.createElement("a");S.download="merged-shape.png",S.href=lt,S.click(),URL.revokeObjectURL(lt)},"image/png")},G.src=A},[n,x,i,f,g]),O=l.length>=3;return e.jsxs(D,{direction:"column",h:"100%",overflow:"hidden",opacity:j?.5:1,pointerEvents:j?"none":"auto",transition:"opacity 0.2s",children:[E&&e.jsx(tt,{mb:4,flexShrink:0,children:E}),e.jsxs(tt,{flex:1,overflowY:"auto",css:{"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},children:[e.jsx(bt,{children:"Tools"}),e.jsxs(D,{gap:2,mb:4,children:[e.jsx(at,{icon:Vt,label:"Add",onClick:p,flex:1}),e.jsx(at,{icon:Nt,label:"Delete",onClick:h,isActive:!1,flex:1}),e.jsx(at,{icon:Ut,label:"Duplicate",onClick:w,flex:1})]}),P&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{children:"Align"}),e.jsxs(D,{gap:2,mb:4,flexWrap:"wrap",children:[e.jsx(at,{icon:ee,onClick:()=>a("left")}),e.jsx(at,{icon:Zt,onClick:()=>a("centerH")}),e.jsx(at,{icon:Qt,onClick:()=>a("right")}),e.jsx(at,{icon:le,onClick:()=>a("top")}),e.jsx(at,{icon:re,onClick:()=>a("centerV")}),e.jsx(at,{icon:ae,onClick:()=>a("bottom")})]}),O&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{children:"Distribute"}),e.jsxs(D,{gap:2,mb:4,children:[e.jsx(at,{icon:oe,label:"Horizontal",onClick:()=>y("horizontal"),flex:1}),e.jsx(at,{icon:he,label:"Vertical",onClick:()=>y("vertical"),flex:1})]})]})]}),F&&!P&&e.jsxs(e.Fragment,{children:[e.jsx(bt,{children:"Selected Shape"}),e.jsxs(D,{direction:"column",gap:2,mb:4,children:[e.jsxs(D,{gap:2,children:[e.jsx($t,{label:"X",value:F.x,onChange:X=>c(F.id,{x:X})}),e.jsx($t,{label:"Y",value:F.y,onChange:X=>c(F.id,{y:X})})]}),e.jsxs(D,{gap:2,children:[e.jsx($t,{label:"W",value:F.w,onChange:X=>c(F.id,{w:Math.max(20,X)}),min:20}),e.jsx($t,{label:"H",value:F.h,onChange:X=>c(F.id,{h:Math.max(20,X)}),min:20})]}),e.jsx($t,{label:"Radius",value:F.r!==void 0?F.r:f,onChange:X=>c(F.id,{r:X}),min:0})]})]}),e.jsx(bt,{children:"Style"}),e.jsx(D,{direction:"column",gap:2,mb:4,children:e.jsx(ve,{label:"Fill",value:g.fill,onChange:X=>u({...g,fill:X})})}),e.jsx(bt,{children:"Settings"}),e.jsx(D,{direction:"column",gap:2,mb:4,children:e.jsx($t,{label:"Radius",value:f,onChange:s,min:0,max:100})})]}),e.jsxs(tt,{bg:"#170D27",border:"1px solid #271E37",borderRadius:"8px",mb:4,flexShrink:0,overflow:"hidden",onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),transition:"all 0.2s ease",children:[e.jsxs(D,{align:"center",justify:"space-between",gap:1.5,p:3,cursor:"pointer",children:[e.jsxs(D,{align:"center",gap:1.5,children:[e.jsx(nt,{as:ue,boxSize:3,color:"#988BC7"}),e.jsx(I,{fontSize:"10px",color:"#988BC7",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.5px",children:"Shortcuts"})]}),e.jsx(nt,{as:Lt,boxSize:3,color:"#988BC7",transform:L?"rotate(0deg)":"rotate(180deg)",transition:"transform 0.2s ease"})]}),e.jsx(tt,{maxH:L?"200px":"0px",opacity:L?1:0,overflow:"hidden",transition:"all 0.2s ease",px:3,pb:L?3:0,children:e.jsxs(D,{direction:"column",gap:1.5,children:[e.jsxs(D,{justify:"space-between",align:"center",children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",children:"Undo"}),e.jsxs(D,{gap:1,children:[e.jsx(xt,{children:"⌘"}),e.jsx(xt,{children:"Z"})]})]}),e.jsxs(D,{justify:"space-between",align:"center",children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",children:"Redo"}),e.jsxs(D,{gap:1,children:[e.jsx(xt,{children:"⌘"}),e.jsx(xt,{children:"⇧"}),e.jsx(xt,{children:"Z"})]})]}),e.jsxs(D,{justify:"space-between",align:"center",children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",children:"Duplicate"}),e.jsxs(D,{gap:1,children:[e.jsx(xt,{children:"⌘"}),e.jsx(xt,{children:"D"})]})]}),e.jsxs(D,{justify:"space-between",align:"center",children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",children:"Delete"}),e.jsx(xt,{children:"⌫"})]}),e.jsxs(D,{justify:"space-between",align:"center",children:[e.jsx(I,{fontSize:"12px",color:"#988BC7",children:"Pan"}),e.jsx(D,{gap:1,align:"center",children:e.jsx(xt,{children:"Space+Drag"})})]})]})})]}),e.jsxs(tt,{pt:4,borderTop:"1px solid #271E37",flexShrink:0,children:[e.jsx(bt,{children:"Export"}),e.jsxs(D,{direction:"column",gap:2,children:[e.jsxs(D,{as:"button",align:"center",justify:"center",gap:2,bg:o==="merged"?"rgba(82, 39, 255, 0.2)":"#170D27",border:o==="merged"?"1px solid #5227FF":"1px solid #271E37",borderRadius:"8px",py:2,cursor:"pointer",onClick:ot,transition:"all 0.15s",_hover:{borderColor:"#5227FF"},children:[e.jsx(nt,{as:be,boxSize:4,color:"#988BC7"}),e.jsx(I,{fontSize:"12px",color:"#988BC7",fontWeight:500,children:o==="merged"?"Copied!":"Merge & Copy (Mask-Ready)"})]}),e.jsxs(D,{gap:2,children:[e.jsxs(D,{as:"button",flex:1,align:"center",justify:"center",gap:2,bg:o==="svg"?"rgba(82, 39, 255, 0.2)":"#170D27",border:o==="svg"?"1px solid #5227FF":"1px solid #271E37",borderRadius:"8px",py:2,cursor:"pointer",onClick:q,transition:"all 0.15s",_hover:{borderColor:"#5227FF"},children:[e.jsx(nt,{as:Dt,boxSize:4,color:"#988BC7"}),e.jsx(I,{fontSize:"12px",color:"#988BC7",fontWeight:500,children:o==="svg"?"Copied!":"Copy SVG"})]}),e.jsxs(D,{as:"button",flex:1,align:"center",justify:"center",gap:2,bg:o==="react"?"rgba(82, 39, 255, 0.2)":"#170D27",border:o==="react"?"1px solid #5227FF":"1px solid #271E37",borderRadius:"8px",py:2,cursor:"pointer",onClick:V,transition:"all 0.15s",_hover:{borderColor:"#5227FF"},children:[e.jsx(nt,{as:Dt,boxSize:4,color:"#988BC7"}),e.jsx(I,{fontSize:"12px",color:"#988BC7",fontWeight:500,children:o==="react"?"Copied!":"Copy React"})]})]}),e.jsxs(D,{as:"button",align:"center",justify:"center",gap:2,bg:o==="css"?"rgba(82, 39, 255, 0.2)":"#170D27",border:o==="css"?"1px solid #5227FF":"1px solid #271E37",borderRadius:"8px",py:2,cursor:"pointer",onClick:W,transition:"all 0.15s",_hover:{borderColor:"#5227FF"},children:[e.jsx(nt,{as:fe,boxSize:4,color:"#988BC7"}),e.jsx(I,{fontSize:"12px",color:"#988BC7",fontWeight:500,children:o==="css"?"Copied!":"Copy CSS clip-path"})]}),e.jsxs(D,{gap:2,children:[e.jsxs(D,{as:"button",flex:1,align:"center",justify:"center",gap:2,bg:"#5227FF",borderRadius:"8px",py:2.5,cursor:"pointer",onClick:ct,transition:"all 0.15s",_hover:{bg:"#6b3fff"},children:[e.jsx(nt,{as:Kt,boxSize:4,color:"#fff"}),e.jsx(I,{fontSize:"12px",color:"#fff",fontWeight:600,children:"Download SVG"})]}),e.jsxs(D,{as:"button",flex:1,align:"center",justify:"center",gap:2,bg:"#5227FF",borderRadius:"8px",py:2.5,cursor:"pointer",onClick:it,transition:"all 0.15s",_hover:{bg:"#6b3fff"},children:[e.jsx(nt,{as:It,boxSize:4,color:"#fff"}),e.jsx(I,{fontSize:"12px",color:"#fff",fontWeight:600,children:"Download PNG"})]})]})]})]})]})}const Bt=(n,x)=>n.r!==void 0?n.r:x,ut=(n,x,i=1)=>Math.abs(n-x)<=i,Ce=(n,x,i=1)=>{const l={};for(const g of n){const f=Bt(g,x);l[g.id]={tl:f,tr:f,br:f,bl:f}}for(let g=0;g<n.length;g++)for(let f=g+1;f<n.length;f++){const p=n[g],h=n[f],w=p.x,u=p.x+p.w,s=p.y,c=p.y+p.h,a=h.x,y=h.x+h.w,E=h.y,j=h.y+h.h;if(ut(u,a,i)){const o=Math.max(s,E),t=Math.min(c,j);t>o&&(s>=o-i&&s<=t+i&&(l[p.id].tr=0),c>=o-i&&c<=t+i&&(l[p.id].br=0),E>=o-i&&E<=t+i&&(l[h.id].tl=0),j>=o-i&&j<=t+i&&(l[h.id].bl=0))}if(ut(w,y,i)){const o=Math.max(s,E),t=Math.min(c,j);t>o&&(s>=o-i&&s<=t+i&&(l[p.id].tl=0),c>=o-i&&c<=t+i&&(l[p.id].bl=0),E>=o-i&&E<=t+i&&(l[h.id].tr=0),j>=o-i&&j<=t+i&&(l[h.id].br=0))}if(ut(c,E,i)){const o=Math.max(w,a),t=Math.min(u,y);t>o&&(w>=o-i&&w<=t+i&&(l[p.id].bl=0),u>=o-i&&u<=t+i&&(l[p.id].br=0),a>=o-i&&a<=t+i&&(l[h.id].tl=0),y>=o-i&&y<=t+i&&(l[h.id].tr=0))}if(ut(s,j,i)){const o=Math.max(w,a),t=Math.min(u,y);t>o&&(w>=o-i&&w<=t+i&&(l[p.id].tl=0),u>=o-i&&u<=t+i&&(l[p.id].tr=0),a>=o-i&&a<=t+i&&(l[h.id].bl=0),y>=o-i&&y<=t+i&&(l[h.id].br=0))}}return l},Se=(n,x,i=1)=>{if(!n||n.length<2)return[];const l=[],g=new Set,f=(p,h,w,u)=>{let s=0;u===0||u===90?s=-w:(u===180||u===270)&&(s=w);const c=p,a=h+s,y=`${Math.round(c)},${Math.round(a)},${u}`;g.has(y)||(g.add(y),l.push({id:`bridge-${l.length}`,x:c,y:a,r:w,rotation:u}))};for(let p=0;p<n.length;p++)for(let h=0;h<n.length;h++){if(p===h)continue;const w=n[p],u=n[h],s=Math.min(Bt(w,x),Bt(u,x)),c=w.x,a=w.x+w.w,y=w.y,E=w.y+w.h,j=u.x,o=u.x+u.w,t=u.y,L=u.y+u.h;ut(a,j,i)&&E>t&&y<L&&(y<t-i&&f(a,t,s,0),E>L+i&&f(a,L,s,270)),ut(c,o,i)&&E>t&&y<L&&(y<t-i&&f(c,t,s,90),E>L+i&&f(c,L,s,180)),ut(E,t,i)&&a>j&&c<o&&(c<j-i&&f(j,E,s,180),a>o+i&&f(o,E,s,270)),ut(y,L,i)&&a>j&&c<o&&(c<j-i&&f(j,y,s,90),a>o+i&&f(o,y,s,0))}return l},Me={fill:"#ffffff",stroke:"none",strokeWidth:0},Ee=32,ze=1,Fe=800,Be=600,De=10,Ye=(n=100,x=100,i=120,l=80)=>({id:`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:n,y:x,w:i,h:l,r:void 0}),Le=()=>({shapes:[{id:"shape-1",x:300,y:150,w:200,h:280,r:void 0},{id:"shape-2",x:500,y:220,w:200,h:140,r:void 0}],style:{...Me},globalRadius:Ee,tolerance:ze,selectedIds:[],canvasWidth:Fe,canvasHeight:Be,snapToGrid:!0,gridSize:De}),Xe=n=>{const[x,i]=b.useState([n]),[l,g]=b.useState(0),f=x[l],p=b.useCallback(c=>{i(a=>[...a.slice(0,l+1),c]),g(a=>a+1)},[l]),h=b.useCallback(()=>{l>0&&g(c=>c-1)},[l]),w=b.useCallback(()=>{l<x.length-1&&g(c=>c+1)},[l,x.length]),u=l>0,s=l<x.length-1;return{current:f,push:p,undo:h,redo:w,canUndo:u,canRedo:s}};function Ie({toolSelector:n}){const x=Gt({base:!0,lg:!1}),[i,l]=b.useState(!1),g=b.useRef(null),f=b.useMemo(()=>Le(),[]),{current:p,push:h,undo:w,redo:u}=Xe(f),[s,c]=b.useState(p.shapes),[a,y]=b.useState([]),[E,j]=b.useState(p.style),[o,t]=b.useState(p.globalRadius),[L,m]=b.useState(!1),F=b.useRef(!1),P=!0,q=10,V=1;b.useEffect(()=>{if(F.current){F.current=!1;return}c(p.shapes),j(p.style),t(p.globalRadius)},[p]);const ot=b.useMemo(()=>Se(s,o,V),[s,o,V]),ct=b.useMemo(()=>Ce(s,o,V),[s,o,V]),W=b.useCallback((S,d,$)=>{F.current=!0,h({shapes:S??s,style:d??E,globalRadius:$??o})},[h,s,E,o]),it=b.useCallback(()=>{const S=Ye(100+Math.random()*200,100+Math.random()*200,120,80),d=[...s,S];c(d),y([S.id]),W(d)},[s,W]),O=b.useCallback(()=>{if(a.length===0)return;const S=s.filter(d=>!a.includes(d.id));c(S),y([]),W(S)},[s,a,W]),X=b.useCallback(()=>{if(a.length===0)return;const S=s.filter($=>a.includes($.id)).map($=>({...$,id:`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:$.x+20,y:$.y+20})),d=[...s,...S];c(d),y(S.map($=>$.id)),W(d)},[s,a,W]),et=b.useCallback((S,d)=>{c($=>$.map(T=>T.id===S?{...T,...d}:T))},[]),A=b.useCallback(()=>{W(s)},[s,W]),G=b.useCallback(S=>{if(a.length<2)return;const d=s.filter(Y=>a.includes(Y.id)),$={minX:Math.min(...d.map(Y=>Y.x)),maxX:Math.max(...d.map(Y=>Y.x+Y.w)),minY:Math.min(...d.map(Y=>Y.y)),maxY:Math.max(...d.map(Y=>Y.y+Y.h))},T=s.map(Y=>{if(!a.includes(Y.id))return Y;switch(S){case"left":return{...Y,x:$.minX};case"right":return{...Y,x:$.maxX-Y.w};case"centerH":return{...Y,x:$.minX+($.maxX-$.minX)/2-Y.w/2};case"top":return{...Y,y:$.minY};case"bottom":return{...Y,y:$.maxY-Y.h};case"centerV":return{...Y,y:$.minY+($.maxY-$.minY)/2-Y.h/2};default:return Y}});c(T),W(T)},[s,a,W]),N=b.useCallback(S=>{if(a.length<3)return;const d=s.filter($=>a.includes($.id)).sort(($,T)=>S==="horizontal"?$.x-T.x:$.y-T.y);if(S==="horizontal"){const $=d[0].x,T=d[d.length-1].x+d[d.length-1].w,Y=d.reduce((H,vt)=>H+vt.w,0),R=(T-$-Y)/(d.length-1);let dt=$;const ht={};d.forEach(H=>{ht[H.id]=dt,dt+=H.w+R});const yt=s.map(H=>ht[H.id]!==void 0?{...H,x:ht[H.id]}:H);c(yt),W(yt)}else{const $=d[0].y,T=d[d.length-1].y+d[d.length-1].h,Y=d.reduce((H,vt)=>H+vt.h,0),R=(T-$-Y)/(d.length-1);let dt=$;const ht={};d.forEach(H=>{ht[H.id]=dt,dt+=H.h+R});const yt=s.map(H=>ht[H.id]!==void 0?{...H,y:ht[H.id]}:H);c(yt),W(yt)}},[s,a,W]),K=b.useRef([]),ft=b.useCallback(()=>{if(a.length===0)return;const S=s.filter(d=>a.includes(d.id)).map(d=>({...d}));K.current=S},[s,a]),gt=b.useCallback(()=>{if(K.current.length===0)return;const S=K.current.map($=>({...$,id:`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,x:$.x+20,y:$.y+20}));K.current=S.map($=>({...$}));const d=[...s,...S];c(d),y(S.map($=>$.id)),W(d)},[s,W]),lt=b.useCallback(S=>{if(S.length===0)return[];const d=s.filter(T=>S.includes(T.id)).map(T=>({...T,id:`shape-${Date.now()}-${Math.random().toString(36).substr(2,9)}`})),$=[...s,...d];return c($),y(d.map(T=>T.id)),d},[s]);return b.useEffect(()=>{const S=d=>{var $,T,Y;(d.metaKey||d.ctrlKey)&&d.key==="z"&&!d.shiftKey&&(d.preventDefault(),w()),(d.metaKey||d.ctrlKey)&&(d.key==="y"||d.shiftKey&&d.key==="z")&&(d.preventDefault(),u()),(d.key==="Delete"||d.key==="Backspace")&&a.length>0&&(($=document.activeElement)==null?void 0:$.tagName)!=="INPUT"&&(d.preventDefault(),O()),(d.metaKey||d.ctrlKey)&&d.key==="d"&&(d.preventDefault(),X()),(d.metaKey||d.ctrlKey)&&d.key==="c"&&((T=document.activeElement)==null?void 0:T.tagName)!=="INPUT"&&a.length>0&&(d.preventDefault(),ft()),(d.metaKey||d.ctrlKey)&&d.key==="v"&&((Y=document.activeElement)==null?void 0:Y.tagName)!=="INPUT"&&K.current.length>0&&(d.preventDefault(),gt())};return window.addEventListener("keydown",S),()=>window.removeEventListener("keydown",S)},[w,u,a,O,X,ft,gt]),e.jsxs(D,{h:"100%",w:"100%",gap:{base:0,lg:4},direction:{base:"column",lg:"row"},position:"relative",overflow:"hidden",children:[e.jsx(tt,{w:"280px",flexShrink:0,h:"100%",overflow:"hidden",display:{base:"none",lg:"flex"},flexDirection:"column",children:e.jsx(Yt,{shapes:s,bridges:ot,cornerRadii:ct,selectedIds:a,style:E,globalRadius:o,onAddShape:it,onDeleteShapes:O,onDuplicateShapes:X,onStyleChange:j,onGlobalRadiusChange:t,onShapeUpdate:et,onAlignShapes:G,onDistributeShapes:N,toolSelector:n})}),e.jsxs(tt,{flex:1,position:"relative",borderRadius:{base:"12px",lg:"16px"},overflow:"hidden",border:"1px solid #271E37",bg:"#060010",maxWidth:"1920px",margin:"0 auto",width:"100%",minH:{base:"400px",lg:"auto"},children:[e.jsx(Tt,{ref:g,shapes:s,bridges:ot,cornerRadii:ct,globalRadius:o,style:E,selectedIds:a,onShapeUpdate:et,onSelectionChange:y,onDragEnd:A,onAltDragDuplicate:lt,snapToGrid:P,gridSize:q,showBridgeDebug:L,onShowBridgeDebugChange:m}),e.jsxs(D,{as:"button",display:{base:"flex",lg:"none"},position:"absolute",bottom:4,right:4,align:"center",gap:2,bg:"#5227FF",px:4,py:2.5,borderRadius:"12px",cursor:"pointer",onClick:()=>l(!0),boxShadow:"0 4px 20px rgba(82, 39, 255, 0.4)",_active:{transform:"scale(0.95)"},transition:"transform 0.1s",children:[e.jsx(nt,{as:qt,boxSize:4,color:"#fff"}),e.jsx(I,{fontSize:"13px",fontWeight:600,color:"#fff",children:"Controls"})]})]}),x&&e.jsxs(e.Fragment,{children:[e.jsx(tt,{position:"fixed",top:0,left:0,right:0,bottom:0,bg:"rgba(0, 0, 0, 0.6)",opacity:i?1:0,visibility:i?"visible":"hidden",transition:"all 0.3s",zIndex:999,onClick:()=>l(!1)}),e.jsxs(tt,{position:"fixed",bottom:0,left:0,right:0,bg:"#0D0716",borderTop:"1px solid #271E37",borderTopRadius:"24px",transform:i?"translateY(0)":"translateY(100%)",transition:"transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)",zIndex:1e3,maxH:"85vh",overflow:"hidden",display:"flex",flexDirection:"column",children:[e.jsx(D,{justify:"center",pt:3,pb:2,cursor:"pointer",onClick:()=>l(!1),children:e.jsx(tt,{w:"40px",h:"4px",bg:"#392e4e",borderRadius:"2px"})}),e.jsxs(D,{align:"center",justify:"space-between",px:4,pb:3,borderBottom:"1px solid #271E37",children:[e.jsx(I,{fontSize:"16px",fontWeight:700,color:"#fff",children:"Controls"}),e.jsx(D,{as:"button",align:"center",justify:"center",w:8,h:8,borderRadius:"8px",bg:"#170D27",cursor:"pointer",onClick:()=>l(!1),_hover:{bg:"#271E37"},children:e.jsx(nt,{as:Lt,boxSize:5,color:"#988BC7"})})]}),e.jsx(tt,{flex:1,overflow:"hidden",px:4,py:4,children:e.jsx(Yt,{shapes:s,bridges:ot,cornerRadii:ct,selectedIds:a,style:E,globalRadius:o,onAddShape:it,onDeleteShapes:O,onDuplicateShapes:X,onStyleChange:j,onGlobalRadiusChange:t,onShapeUpdate:et,onAlignShapes:G,onDistributeShapes:N,toolSelector:n})})]})]})]})}export{Ie as default};
