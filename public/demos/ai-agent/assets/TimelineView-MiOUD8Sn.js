import{r as l,b as A,j as c}from"./index-CuoSW9a6.js";import{u as O}from"./useQuery-1-ZV3XJR.js";import{r as T,c as _,a as L,S as M,b as F,u as I,s as B,d as W,e as K,f as q,g as H,h as R,i as C,j as $,k as D,l as V,m as x,R as U,B as J,C as G,X,Y,T as Q,n as w}from"./Charts.module-0qO_SaXE.js";import"./with-selector-SQ-W3dkg.js";function j(){return j=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},j.apply(null,arguments)}function E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Z(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?E(Object(r),!0).forEach(function(n){ee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ee(e,t,r){return(t=te(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function te(e){var t=re(e,"string");return typeof t=="symbol"?t:t+""}function re(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var p=32,ne={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function ae(e){var{data:t,iconType:r,inactiveColor:n}=e,a=p/2,o=p/6,f=p/3,g=t.inactive?n:t.color,u=r??t.type;if(u==="none")return null;if(u==="plainline"){var d;return l.createElement("line",{strokeWidth:4,fill:"none",stroke:g,strokeDasharray:(d=t.payload)===null||d===void 0?void 0:d.strokeDasharray,x1:0,y1:a,x2:p,y2:a,className:"recharts-legend-icon"})}if(u==="line")return l.createElement("path",{strokeWidth:4,fill:"none",stroke:g,d:"M0,".concat(a,"h").concat(f,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(2*f,",").concat(a,`
            H`).concat(p,"M").concat(2*f,",").concat(a,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(f,",").concat(a),className:"recharts-legend-icon"});if(u==="rect")return l.createElement("path",{stroke:"none",fill:g,d:"M0,".concat(p/8,"h").concat(p,"v").concat(p*3/4,"h").concat(-p,"z"),className:"recharts-legend-icon"});if(l.isValidElement(t.legendIcon)){var s=Z({},t);return delete s.legendIcon,l.cloneElement(t.legendIcon,s)}return l.createElement(F,{fill:g,cx:a,cy:a,size:p,sizeType:"diameter",type:u})}function ie(e){var{payload:t,iconSize:r,layout:n,formatter:a,inactiveColor:o,iconType:f}=e,g={x:0,y:0,width:p,height:p},u={display:n==="horizontal"?"inline-block":"block",marginRight:10},d={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((s,m)=>{var h=s.formatter||a,i=_({"recharts-legend-item":!0,["legend-item-".concat(m)]:!0,inactive:s.inactive});if(s.type==="none")return null;var v=s.inactive?o:s.color,b=h?h(s.value,s,m):s.value;return l.createElement("li",j({className:i,style:u,key:"legend-item-".concat(m)},L(e,s,m)),l.createElement(M,{width:r,height:r,viewBox:g,style:d,"aria-label":"".concat(b," legend icon")},l.createElement(ae,{data:s,iconType:f,inactiveColor:o})),l.createElement("span",{className:"recharts-legend-item-text",style:{color:v}},b))})}var oe=e=>{var t=T(e,ne),{payload:r,layout:n,align:a}=t;if(!r||!r.length)return null;var o={padding:0,margin:0,textAlign:n==="horizontal"?a:"left"};return l.createElement("ul",{className:"recharts-default-legend",style:o},l.createElement(ie,j({},t,{payload:r})))};function le(){return I(B)}var ce=["contextPayload"];function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},P.apply(null,arguments)}function k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function y(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k(Object(r),!0).forEach(function(n){se(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function se(e,t,r){return(t=ue(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ue(e){var t=de(e,"string");return typeof t=="symbol"?t:t+""}function de(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fe(e,t){if(e==null)return{};var r,n,a=ge(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function ge(e,t){if(e==null)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.indexOf(n)!==-1)continue;r[n]=e[n]}return r}function he(e){return e.value}function pe(e){var{contextPayload:t}=e,r=fe(e,ce),n=V(t,e.payloadUniqBy,he),a=y(y({},r),{},{payload:n});return l.isValidElement(e.content)?l.cloneElement(e.content,a):typeof e.content=="function"?l.createElement(e.content,a):l.createElement(oe,a)}function me(e,t,r,n,a,o){var{layout:f,align:g,verticalAlign:u}=t,d,s;return(!e||(e.left===void 0||e.left===null)&&(e.right===void 0||e.right===null))&&(g==="center"&&f==="vertical"?d={left:((n||0)-o.width)/2}:d=g==="right"?{right:r&&r.right||0}:{left:r&&r.left||0}),(!e||(e.top===void 0||e.top===null)&&(e.bottom===void 0||e.bottom===null))&&(u==="middle"?s={top:((a||0)-o.height)/2}:s=u==="bottom"?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),y(y({},d),s)}function ve(e){var t=C();return l.useEffect(()=>{t($(e))},[t,e]),null}function ye(e){var t=C();return l.useEffect(()=>(t(D(e)),()=>{t(D({width:0,height:0}))}),[t,e]),null}function be(e,t,r,n){return e==="vertical"&&t!=null?{height:t}:e==="horizontal"?{width:r||n}:null}var je={align:"center",iconSize:14,inactiveColor:"#ccc",itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function z(e){var t=T(e,je),r=le(),n=W(),a=K(),{width:o,height:f,wrapperStyle:g,portal:u}=t,[d,s]=q([r]),m=H(),h=R();if(m==null||h==null)return null;var i=m-(a?.left||0)-(a?.right||0),v=be(t.layout,f,o,i),b=u?g:y(y({position:"absolute",width:v?.width||o||"auto",height:v?.height||f||"auto"},me(g,t,a,m,h,d)),g),S=u??n;if(S==null||r==null)return null;var N=l.createElement("div",{className:"recharts-legend-wrapper",style:b,ref:s},l.createElement(ve,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!u&&l.createElement(ye,{width:d.width,height:d.height}),l.createElement(pe,P({},t,v,{margin:a,chartWidth:m,chartHeight:h,contextPayload:r})));return A.createPortal(N,S)}z.displayName="Legend";function xe(){return new Date(Date.now()-2592e6).toISOString().split("T")[0]}function we(){return new Date().toISOString().split("T")[0]}function Pe(e,t){const r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(t==="week"){const a=e.match(/^(\d{4})-W(\d{1,2})$/);if(a){const o=parseInt(a[1],10),f=parseInt(a[2],10),g=new Date(o,0,1),u=(f-1)*7-g.getDay()+1,d=new Date(o,0,1+u);return r[d.getMonth()]+" "+d.getDate()}}if(t==="hour"){const a=e.match(/^(\d{4}-\d{2}-\d{2})\s+(\d{2}):(\d{2})$/);if(a){const o=new Date(a[1]+"T"+a[2]+":"+a[3]+":00");if(!isNaN(o.getTime()))return r[o.getMonth()]+" "+o.getDate()+" "+o.getHours().toString().padStart(2,"0")+":00"}}const n=new Date(e+(e.includes("T")?"":"T00:00:00"));return isNaN(n.getTime())?e:r[n.getMonth()]+" "+n.getDate()}function ke(){const[e,t]=l.useState("day"),[r,n]=l.useState(""),[a,o]=l.useState(xe),[f,g]=l.useState(we),{data:u}=O({queryKey:["timeline-projects"],queryFn:async()=>{const i=await fetch("/api/db/projects");return i.ok?i.json():[]}}),d=l.useMemo(()=>{const i=new URLSearchParams;return i.set("granularity",e),r&&i.set("project",r),a&&i.set("dateFrom",String(new Date(a).getTime())),f&&i.set("dateTo",String(new Date(f+"T23:59:59").getTime())),i.toString()},[e,r,a,f]),{data:s,isLoading:m}=O({queryKey:["timeline",d],queryFn:async()=>{const i=await fetch(`/api/db/analytics/timeline?${d}`);return i.ok?i.json():{buckets:[]}}}),h=l.useMemo(()=>s?.buckets?s.buckets.map(i=>({...i,label:Pe(i.period,e)})):[],[s,e]);return c.jsxs("div",{className:x.timelineView,"data-testid":"timeline-view",children:[c.jsxs("div",{className:x.timelineControls,children:[c.jsxs("select",{value:e,onChange:i=>t(i.target.value),children:[c.jsx("option",{value:"hour",children:"Hourly"}),c.jsx("option",{value:"day",children:"Daily"}),c.jsx("option",{value:"week",children:"Weekly"})]}),c.jsxs("select",{value:r,onChange:i=>n(i.target.value),children:[c.jsx("option",{value:"",children:"All Projects"}),u?.map(i=>c.jsx("option",{value:i.project_path,children:i.project_name},i.project_path))]}),c.jsx("input",{type:"date",value:a,onChange:i=>o(i.target.value)}),c.jsx("input",{type:"date",value:f,onChange:i=>g(i.target.value)})]}),c.jsx("div",{className:x.timelineChart,children:m?c.jsx("div",{style:{color:"var(--text-dim)",padding:"40px",textAlign:"center"},children:"Loading..."}):h.length===0?c.jsx("div",{style:{color:"var(--text-dim)",padding:"40px",textAlign:"center"},children:"No data for this period"}):c.jsx(U,{width:"100%",height:350,children:c.jsxs(J,{data:h,margin:{top:10,right:10,left:0,bottom:20},children:[c.jsx(G,{strokeDasharray:"3 3",stroke:"rgba(255,255,255,0.06)"}),c.jsx(X,{dataKey:"label",stroke:"#8892b0",fontSize:9,interval:h.length>15?Math.ceil(h.length/15):0,angle:h.length>10||e==="hour"?-40:0,textAnchor:h.length>10||e==="hour"?"end":"middle",height:e==="hour"?60:40}),c.jsx(Y,{stroke:"#8892b0",fontSize:10}),c.jsx(Q,{contentStyle:{background:"var(--bg-card, #12122a)",border:"1px solid var(--accent-cyan, #00e5ff)",borderRadius:"4px",fontSize:"11px",color:"var(--text-primary, #e0e0ff)"}}),c.jsx(z,{wrapperStyle:{fontSize:"10px",color:"#8892b0"}}),c.jsx(w,{dataKey:"session_count",name:"Sessions",fill:"#00e5ff",opacity:.85,radius:[2,2,0,0]}),c.jsx(w,{dataKey:"prompt_count",name:"Prompts",fill:"#00ff88",opacity:.85,radius:[2,2,0,0]}),c.jsx(w,{dataKey:"tool_call_count",name:"Tool Calls",fill:"#ff9800",opacity:.85,radius:[2,2,0,0]})]})})})]})}export{ke as default};
